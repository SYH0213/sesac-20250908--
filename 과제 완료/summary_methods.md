
# 📚 문서 요약 기법 5가지 정리

LangChain 등 LLM 기반 워크플로우에서 자주 사용하는 대표적인 요약 방식 5가지를 정리했습니다.  
각 방식은 문서를 어떻게 분할하고, 어떤 프롬프트 체인으로 요약하는지가 다릅니다.

---

## 1️⃣ Stuff

**개념**  
- 문서 전체를 한 번에 LLM에 넣어 요약하는 가장 단순한 방식  

**동작**  
```
문서 전체 → 프롬프트에 그대로 삽입 → LLM 요약
```

**장점**  
- 구현이 간단하고 빠름  
- 짧은 문서에 적합  

**단점**  
- 문서가 길면 LLM 입력 한계를 초과  
- 긴 문서에서는 중요한 내용이 잘릴 수 있음  

**프롬프트 예시**
```text
아래 문서를 간결하게 요약해 주세요.

문서:
{context}

요약:
```

---

## 2️⃣ Map-Reduce

**개념**  
- 문서를 **여러 청크로 분할**한 뒤, 각 청크를 요약(Map) → 요약본들을 다시 통합(Reduce)  

**동작**  
```
문서 → [청크1, 청크2, …]
  Map 단계: 각 청크 요약
  Reduce 단계: 부분 요약들을 최종 요약으로 통합
```

**장점**  
- 긴 문서에도 적용 가능  
- 병렬 처리 가능 → 속도 빠름  

**단점**  
- 각 청크 요약에 빠진 정보는 최종 요약에서도 반영되지 않음  

**프롬프트 예시**
- Map:
```text
다음 청크를 한국어로 요약하세요.

청크:
{context}

부분 요약:
```
- Reduce:
```text
다음은 여러 부분 요약입니다. 
중복을 제거하고 핵심만 모아 최종 요약을 작성하세요.

부분 요약들:
{context}

최종 요약:
```

---

## 3️⃣ Refine (Map-Refine)

**개념**  
- 문서를 순서대로 보면서, **기존 요약을 보강/수정**하는 방식  

**동작**  
```
청크1 → 초기 요약
청크2 + 기존 요약 → 개선된 요약
청크3 + 개선된 요약 → 더 개선된 요약
...
```

**장점**  
- 문맥이 이어져 일관성 유지  
- 누락된 정보 보완 가능  

**단점**  
- 순차 처리라 느림  
- 첫 요약 품질에 따라 결과가 크게 좌우됨  

**프롬프트 예시**
- 초기 요약:
```text
다음 청크를 요약하세요.

청크:
{context}

초기 요약:
```
- Refine:
```text
기존 요약:
{existing_summary}

새 청크:
{context}

기존 요약을 유지하되, 새 정보를 반영해 개선된 요약을 작성하세요.

개선된 요약:
```

---

## 4️⃣ Chain of Density (CoD)

**개념**  
- 요약을 반복 실행하며 **빠진 정보(엔티티, 수치, 개념 등)를 찾아 보강**  
- **짧으면서도 정보 밀도가 높은 요약**을 만드는 기법  

**동작**  
```
초기 요약 → 누락 탐지 → 보강 요약 (길이 유지) → 반복
```

**장점**  
- 정보 누락 최소화  
- 짧고 알찬 요약 생성 가능  

**단점**  
- 여러 번 실행해야 하므로 비용/시간 ↑  
- 지나치게 압축되면 가독성 저하  

**프롬프트 예시**
- 초기 요약:
```text
다음 문서를 100단어 이내로 요약해 주세요.

문서:
{context}

요약:
```
- 보강 요약:
```text
이전 요약:
{summary}

문서의 중요한 개체/정보 중 빠진 것이 있다면 포함해 
다시 요약하세요. 단, 길이는 동일하거나 더 짧게 유지하세요.

개선된 요약:
```

---

## 5️⃣ Clustering-Map-Refine

**개념**  
- **비슷한 청크끼리 클러스터링** → 각 클러스터 대표 텍스트 요약(Map) → Refine 방식으로 보강  

**동작**  
```
문서 → 청크 분할 → 클러스터링
클러스터 대표 청크 → 부분 요약(Map)
부분 요약들 → Refine 방식으로 최종 통합
```

**장점**  
- 중복 제거, 주제별 정리 효과  
- 긴 문서에서도 구조적 요약 가능  

**단점**  
- 임베딩/클러스터링 연산 필요 → 복잡도 ↑  
- 클러스터링 품질에 따라 결과 품질도 달라짐  

**프롬프트 예시**
- 클러스터 요약(Map):
```text
아래는 같은 주제의 텍스트 묶음입니다. 
중복을 제거하고 핵심 개념을 요약하세요.

문서 묶음:
{cluster_texts}

부분 요약:
```
- Refine 통합:
```text
기존 요약:
{existing_summary}

새 부분 요약:
{cluster_summary}

기존 요약을 유지하되, 새 정보를 반영해 보강하세요.

개선된 최종 요약:
```

---

# 📊 비교 요약

| 방식 | 아이디어 | 장점 | 단점 | 적합한 경우 |
|------|----------|------|------|--------------|
| Stuff | 문서 전체를 한 번에 요약 | 단순, 빠름 | 문서 길이 한계 | 짧은 문서 |
| Map-Reduce | 청크 요약 후 최종 통합 | 긴 문서 가능, 병렬 빠름 | 청크간 맥락 약함 | 대용량 기사, 보고서 |
| Refine | 순차적으로 보강 요약 | 일관성↑, 누락↓ | 느림, 초기 요약 품질 의존 | 논문, 정책 보고서 |
| Chain of Density | 반복 압축+보강 | 짧고 밀도 높은 요약 | 비용/시간↑ | TL;DR, Executive Summary |
| Clustering-Map-Refine | 클러스터링 후 Refine | 중복↓, 주제별 구조화 | 복잡도↑ | 긴 책, 주제별 문서 모음 |
